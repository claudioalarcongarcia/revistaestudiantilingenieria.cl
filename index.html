<!doctype html>
<html lang="es">
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Revista Estudiantil Ingeniería</title>
  <link rel="stylesheet" href="styles.css?v=6">
</head>

<body class="app-bg">

<!-- Barra superior fija -->
<header class="app-topbar">
  <div class="app-topbar-inner">
  <div class="app-topbar-title">Revista Estudiantil Ingeniería</div>
    <nav class="app-topbar-nav">
      <a class="navbtn" href="index.html">Inicio</a>
      <a class="navbtn" href="procesados.html">Procesados</a>
      <a class="navbtn" href="no_procesados.html">No procesados</a>
      <a class="navbtn" href="#">Acerca de</a>
    </nav>
  </div>
</header>

<!-- Layout principal -->
<main class="app-shell">

  <!-- Columna izquierda -->
  <aside class="app-col app-left">
    <div class="app-stack">
      <a class="btn2" href="procesados.html">Procesados</a>
      <a class="btn2 ghost" href="no_procesados.html">No procesados</a>
    </div>

    <div class="app-links">
      <a href="#">Protocolo editorial</a>
      <a href="procesados.html">Estados editoriales</a>
      <a href="no_procesados.html">Ingreso de trabajos</a>
      <a href="#">Normas de publicación</a>
      <a href="#">Equipo editorial</a>
      <a href="#">Contacto</a>
    </div>
  </aside>

  <!-- Columna central -->
  <section class="app-col app-mid">

    <!-- Video -->
    <div class="block">
      <div class="blocktitle">Video</div>

      <!-- Reemplace VIDEO_ID -->
      <div class="video">
        <iframe
          src="https://www.youtube.com/embed/VIDEO_ID?autoplay=1&mute=1&playsinline=1&rel=0"
          title="Video institucional"
          frameborder="0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>

      <div class="note">
        El video se reproduce automáticamente en modo silencioso.
      </div>
    </div>

    <!-- Últimos artículos -->
    <div class="block">
      <div class="blocktitle">Últimos artículos</div>
      <div id="latestList" class="latest"></div>
      <div id="latestMsg" class="note"></div>
    </div>

  </section>

  <!-- Columna derecha -->
  <aside class="app-col app-right">
    <div class="block">
      <div class="blocktitle">Noticias</div>
      <div class="app-links">
        <a href="#" target="_blank">Ciencia y tecnología</a>
        <a href="#" target="_blank">Eventos académicos</a>
        <a href="#" target="_blank">Convocatorias estudiantiles</a>
        <a href="#" target="_blank">Innovación y emprendimiento</a>
        <a href="#" target="_blank">Seminarios y conferencias</a>
      </div>
    </div>
  </aside>

</main>

<script>
/* ================= CONFIG ================= */
const SHEET_ID = "1xWRo_TaaJT83s4n5f7W4Apt9Da3M2Bd0q-UgcpyPnaE";
const SHEET_NAME = "Hoja 01";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;

/* ================= UTILIDADES ================= */
function norm(s){ return (s ?? "").replace(/\s+/g," ").trim(); }

function parseCSV(text){
  const rows=[], row=[]; let cur="", inQ=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(c=='"' && inQ && n=='"'){cur+='"';i++;continue;}
    if(c=='"'){inQ=!inQ;continue;}
    if(c=="," && !inQ){row.push(cur);cur="";continue;}
    if((c=="\n"||c=="\r")&&!inQ){
      if(c=="\r"&&n=="\n")i++;
      row.push(cur);cur="";
      if(row.some(x=>x.trim())) rows.push(row.splice(0));
      continue;
    }
    cur+=c;
  }
  row.push(cur);
  if(row.some(x=>x.trim())) rows.push(row);

  const headers = rows.shift().map(h=>h.trim());
  return rows.map(r=>{
    const o={}; headers.forEach((h,i)=>o[h]=(r[i]||"").trim());
    return o;
  });
}

function parseDate(s){
  const v=norm(s);
  if(!v) return 0;
  const t=Date.parse(v.length==4?`${v}-01-01`:v);
  return isNaN(t)?0:t;
}

/* ================= LÓGICA ================= */
function pickTop10(docs){
  const order=["Vigente","Vigente con observaciones","No clasificado"];
  const out=[];
  for(const st of order){
    docs
      .filter(d=>norm(d.Estado)===st)
      .sort((a,b)=>parseDate(b.Año)-parseDate(a.Año))
      .forEach(d=>{ if(out.length<10) out.push(d); });
    if(out.length>=10) break;
  }
  return out;
}

function renderItem(d){
  const id=norm(d.Identificador);
  const titulo=norm(d.Título)||norm(d.Titulo)||"Documento";
  const autores=norm(d.Autores)||"-";
  const anio=norm(d.Año)||"-";
  const estado=norm(d.Estado)||"-";
  return `
    <div class="item">
      <div class="itemt">
        <a href="articulo.html?id=${encodeURIComponent(id)}">${titulo}</a>
      </div>
      <div class="itemm">${autores} · ${anio} · ${estado} · ID ${id}</div>
    </div>
  `;
}

/* ================= INIT ================= */
(async()=>{
  const list=document.getElementById("latestList");
  const msg=document.getElementById("latestMsg");
  try{
    const res=await fetch(CSV_URL,{cache:"no-store"});
    if(!res.ok) throw new Error("No se pudo leer el Google Sheet.");
    const csv=await res.text();
    const docs=parseCSV(csv);
    const top=pickTop10(docs);
    if(!top.length){
      msg.textContent="No hay artículos disponibles.";
      return;
    }
    list.innerHTML=top.map(renderItem).join("");
  }catch(e){
    msg.textContent=e.message;
  }
})();
</script>

</body>
</html>

